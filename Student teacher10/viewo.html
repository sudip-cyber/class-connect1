<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stored Student Profiles</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 30px;
      background: linear-gradient(to right, #83a4d4, #b6fbff);
    }

    h2 {
      text-align: center;
      color: #fff;
      margin-bottom: 30px;
    }

    #profilesContainer {
      display: flex;
      flex-direction: column;
      gap: 20px;
      max-width: 900px;
      margin: auto;
    }

    .student-card {
      display: flex;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
      color: #333;
      align-items: center;
    }

    .student-photo {
      width: 130px;
      height: 130px;
      border-radius: 50%;
      object-fit: cover;
      margin-right: 25px;
      border: 3px solid white;
    }

    .student-info {
      flex-grow: 1;
    }

    .student-info p {
      margin: 6px 0;
      font-size: 15px;
    }

    .remarks-input {
      display: none;
      margin-top: 10px;
      padding: 8px;
      width: 100%;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    .logout-btn {
      display: block;
      margin: 40px auto 0;
      padding: 12px 25px;
      background-color: #dc3545;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .logout-btn:hover {
      background-color: #b02a37;
    }
  </style>
</head>

<body>

<script src="includes/storage-shim.js"></script>

  <h2>Stored Student Profiles</h2>
  <div class="buttons" style="width:100%;max-width:900px;display:flex;justify-content:flex-end;gap:12px;margin-bottom:12px;">
    <button class="viewo-btn" onclick="goToViewO()">View Other Profiles</button>
    <button class="teachers-btn" onclick="viewTeachers()">Teachers</button>
    <button class="viewo-btn" onclick="location.href='sdetails.html'">My Profile</button>
  </div>
  <div style="max-width:900px;margin:auto;">
    <table id="profilesTable" style="width:100%;border-collapse:collapse;background:rgba(255,255,255,0.12);border-radius:8px;overflow:hidden;">
      <thead style="background:rgba(255,255,255,0.08);color:#fff;text-align:left;">
        <tr>
          <th style="padding:14px 16px;border-bottom:1px solid rgba(255,255,255,0.06)">Name</th>
          <th style="padding:14px 16px;border-bottom:1px solid rgba(255,255,255,0.06)">Roll No.</th>
        </tr>
      </thead>
      <tbody id="profilesTableBody"></tbody>
    </table>
  </div>
  <button class="logout-btn" onclick="logout()">Logout</button>

  <script>
    function displayProfiles() {
      const tbody = document.getElementById('profilesTableBody');
      tbody.innerHTML = '';
      const users = Object.keys(localStorage)
        .filter(k => k.startsWith('user_'))
        .map(k => { try { return JSON.parse(localStorage.getItem(k) || '{}'); } catch(e) { return null; } })
        .filter(Boolean);
      if (!users.length) {
        tbody.innerHTML = '<tr><td colspan="2" style="padding:16px;color:#fff;text-align:center">No student profiles found.</td></tr>';
        return;
      }
      users.sort((a,b) => {
        const ra = Number(a.rollNo);
        const rb = Number(b.rollNo);
        if (!isNaN(ra) && !isNaN(rb)) return ra - rb;
        return String(a.rollNo).localeCompare(String(b.rollNo));
      });
      users.forEach(d => {
        try {
          const tr = document.createElement('tr');
          tr.style.borderBottom = '1px solid rgba(255,255,255,0.04)';
          tr.innerHTML = `<td style="padding:12px 16px;color:#fff">${escapeHtml(d.name || '')}</td><td style="padding:12px 16px;color:#fff">${escapeHtml(d.rollNo || '')}</td>`;
          tbody.appendChild(tr);
        } catch (e) { /* ignore malformed */ }
      });
    }

    function logout() {
      localStorage.removeItem('currentUserId');
      window.location.href = 'log.html';
    }

    function escapeHtml(str){ return String(str||'').replace(/[&<>'"]/g, function(m){return {'&':'&amp;','<':'&lt;','>':'&gt;',"'":"&#39;",'"':'&quot;'}[m];}); }

    function goToViewO() {
      // already on viewo, but keep parity with sdetails handlers
      window.location.href = 'viewo.html';
    }

    function viewTeachers() {
      try { localStorage.setItem('fromTStoreSource', 'viewo'); } catch (e) {}
      window.location.href = 'tstore1.html';
    }

    window.onload = displayProfiles;
  </script>

</body>
</html>
